---
template: post
title: JenkinsからGitHub Actionsへの完全移行をキメた
slug: /posts/migrate-to-github-actions
draft: true
date: 2021-04-19T08:46:08.841Z
description: JenkinsからGitHub Actionsへ完全移行をキメたのでtipsまとめます。
category: CICD
tags:
  - Jenkins
  - GitHub Actions
---
社のCI/CDをJenkinsからGitHub Actionsに完全移行しました。

## 環境
- レポジトリは約15くらい
- Amazon ECSとAWS Elastic Beanstalkにデプロイする
- アプリケーションは全部Java / Spring Boot（Gradle）

## 移行の背景
2019年までに作ったアプリケーションのデプロイ・リリース作業はJenkinsで行なっていました。2020年に入ってコンテナ化が進み、AWS CodeBuild・AWS CodeDeployを使ってデプロイするようになったり、一部ではGitHub Actionsを使ってデプロイするようになったりとデプロイ・リリース方法が多様化していきました。\
JenkinsはEC2インスタンス立てて、そこにインストールしていましたが長年メンテナンスされてなかったし、ジョブの作り上デプロイ完了待ちが発生していました。

移行の決め手をまとめると、次のような感じです。
1. デプロイ・リリース方法が多様化されている上にちゃんとドキュメントがなく、全環境の手順把握してる人がいないため、使うツールや手順を統一したい
2. Jenkinsのメンテナンスされてこなかったし、これからもメンテナンスしたくない。
3. ジョブの作り上、ビルド・デプロイに時間がかかるため、改善したい。

既存で使われていたのが、AWS CodeBuild・AWS CodeDeployとGitHub Actionsだったのでこの2択でした。前者だと、設定ファイル結構用意しないといけないしデプロイ作業が手間そうだったので、GitHub Actionsに決めました。

## 必須要件
監査の都合上、いくつか必須要件がありました。

1. Slackにデプロイ通知をする（誰が、いつ、どのバージョンをデプロイしたかわかるように）
2. デプロイログを一定期間残す

## 移行方針
1. 移行完了が3ヶ月くらいはかかる見込みで、作業進めていく中でGitHub ActionsやAWSに新しい方法とかサービス出てるかもしれないが、取り入れずに一旦今の時点に揃えることする。（よりよくするのはその後）
2. すでにAWS CodeBuild・AWS CodeDeployを使っているものは2つくらいだったので一旦無視する。

## 移行作業
移行にあたって、現状調査からはじめました。（デプロイ・リリース手順を洗い出してみると、想像以上にいろんな手順があった…）\
その後、GitHub Actionsの公式ドキュメントを全部読んでどういうワークフローにするか設計しました。\
一番重要な要件ともいえる「実行ログ残す件」ですが、今はプライベートレポジトリの実行ログ保存期間は最大400日になっていますが、当時は最大90日だった（気がする）のでログを永続化する方法を考えました。\
