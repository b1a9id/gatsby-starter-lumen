---
template: post
title: Javaパフォーマンス本を読んで
slug: /posts/read-java-performance/
draft: true
date: 2019-05-03T06:16:18.761Z
description: Javaパフォーマンス本を読んで
category: 読書
tags:
  - Java
---
# 実アプリケーションでテストする
パフォーマンステストに利用できるコードは、マイクロベンチマーク、マクロベンチマーク、メゾベンチマークの３種類にカテゴライズできる。

## マイクロベンチマーク
これは、とても小さな単位でパフォーマンスを測定するためのテストです。マイクロベンチマーク用の正しいコードを書くことはとても難しいです。  
- 処理結果を利用しなければならない  
処理結果を変数に書き込むだけでは、コンパイラが処理が不要と判断して処理自体を削除する可能性があるので、変数に書き込んだあとは読み出す必要があります。  

- 不必要な処理を含めてはならない  
テスト用に乱数を生成する処理など、ベンチマーク用の処理を計測時間に含んでしまうと、意図したベンチマークが取れないので気をつける必要があります。  

- 正しい入力に基づいて測定しなければならない  
テストように生成する乱数が入力値の範囲内にない場合など、使われ方を反映したとは言えません。適切な範囲の値を使うようにする必要があります。  

なお、ベンチマークを取る際は、ウォームアップを行って置かないとコード本体だけでなくコンパイルのパフォーマンスも測定してしまうので、気をつける必要があります。   
マイクロベンチマークの作成は容易ではなく、役に立つケースは限られます。落とし穴について理解して、適切なマイクロベンチマークの作成メリットがあるのか（あるいは、よりマクロなレベルのテストに注力する方がよいのか）どうかを理解しましょう。

# スループット、バッチ、レスポンスタイムを理解する
## バッチ（一括）処理の測定
パフォーマンス測定するための最も簡単な方法は、ある作業にどの程度の時間がかかっているかを調べるというものです。  
Javaは、JIT(just-in-time)コンパイルという厄介者がいて、コードが完全に最適化され十分なパフォーマンスを発揮するためには数分またはそれ以上の時間が必要です。このため、Javaのパフォーマンスに関する調査ではウォームアップの時間がとても重視されています。
